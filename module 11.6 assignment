-- question 1:
WITH locations as
(
SELECT  
DATE(date) as rain_date
FROM weather
WHERE events = 'Rain'
GROUP BY 1
)
SELECT
t.trip_id,
t.duration,
DATE(t.start_date)
FROM trips t
JOIN locations l
ON l.rain_date = DATE(t.start_date)
ORDER BY duration DESC
LIMIT 3;

-- question 2 first attempt: 
SELECT 
status.station_id,
(CASE WHEN docks_available = 0 THEN 'full' END) dock_status, 
COUNT(*) as counts
FROM status
GROUP BY 1, 2
ORDER BY 2 DESC;
-- question 2 final answer: 
SELECT
	stations.station_id,
	stations.name,
	COUNT (CASE WHEN docks_available = 0 THEN 1 end) counts
FROM stations
JOIN status
ON stations.station_id=status.station_id
GROUP BY 1, 2
ORDER BY 3 DESC;

-- question 3:
SELECT 
	stations.name,
	COUNT(CASE WHEN start_station = name THEN 1 END) trip_counts,
	stations.dockcount
FROM
	stations
JOIN
	trips
ON
	trips.start_station = stations.name
GROUP BY 1, 3
ORDER BY 3 DESC;

-- question 4:
WITH rainy_days AS
(SELECT
DATE(date) as dates
FROM weather
WHERE events = 'Rain')
SELECT
trips.trip_id,
DATE(trips.start_date),
trips.duration
FROM rainy_days
JOIN trips
ON DATE(trips.start_date)=dates
GROUP BY 1,2,3
ORDER BY 3 desc;
